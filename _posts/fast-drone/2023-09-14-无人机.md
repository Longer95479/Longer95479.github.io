---
layout: post
title:  "无人机相关"
date:   2023-09-14 13:00:00 +0800
tags: quadcopter drone
categories:
    - fast-drone
---

介绍四轴硬件及控制思路。

## 了解了无人机主要技术参数

以下是较为重要的参数：

- 重量：894g（不含电池），1008g（含电池）
- 对角线轴距：230mm
- 最大有效载荷：800g
- 电池
    - 型号：格氏 GS-4000mAh-25C-3S1P
    - 电池类型：LIPO锂电池
    - 有效容量：4000mAh
    - 使用电压：10.8~12.6V
    - 存放电压：11.4V

更多参数详见：[P230技术参数](https://docs.amovlab.com/prometheuswiki/#/src/P230%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/%E6%8A%80%E6%9C%AF%E5%8F%82%E6%95%B0)

## 了解了PX4飞控的控制架构

了解控制器的控制架构，可以避免盲目调参。

多旋翼的控制架构：
- 级联控制结构，位置环为最外环，加速度和偏航角本质上是由四轴的姿态来控制的
- 控制器采用P和PID控制的组合方式
- 状态估计来自EKF2模块。
- 在某些模式下，外环(位置回路) 可能会被绕过 (在图中表示为外环之后增加一个多路开关)。 只有在位置保持模式或某轴无速度请求时，位置回路才会发挥作用。


![control loop](/assets/2023-09-14-无人机/image.png)
详见：[PX4控制器图解](https://docs.px4.io/main/zh/flight_stack/controller_diagrams.html)

## 在自稳模式下进行了试飞
过程如下：
- 检查遥控器是否设置了紧急断电通道；
- 遥控器所有开关上拨，进入自稳遥控模式
- 将四轴放置在空旷处
- 电池电压检查，连接电池与飞控
- 左摇杆拨向右下角一段时间解锁飞控，解锁后，需要把左摇杆拉到最低，使无人机电机怠速运行（有的遥控器左摇杆自动回中，如果没有主动拉低左摇杆，无人机会不断向上加速，在室内容易撞到天花板）
- 手动稳定飞机的位置
- 降落时控制油门，避免无人机下降速度太快，导致“硬着陆”，降落后左摇杆摇向左下锁定无人机；
- 出现意外情况下拨七通道对应的开关，所有电机将立刻停转。

## 学习了卡尔曼滤波的推导

- 利用了链式法则，将联合概率表示成多个条件概率的乘积
- 利用马尔可夫链的假设，简化条件概率的表达形式
- 根据条件概率的定义，写出给定测量值时的本时刻状态后验概率，以及下一时刻的状态后验概率
- 对比相邻时刻状态后验概率表达式，得到时间更新和测量更新公式

详见：[kalman_filter](https://lall.stanford.edu/engr207b/lectures/kalman_filter_2011_02_22_01.pdf)