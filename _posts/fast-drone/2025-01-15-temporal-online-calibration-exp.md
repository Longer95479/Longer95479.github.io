---
layout: post
title:  "Realization of Online Temporal Calibration on AirSLAM" 
date:   2024-06-15 21:24:00 +0800
tags: 
    - slam
    - calibration
categories:
    - coding 
---

AirSLAM 在公开数据集上的效果很不错，但在笔者自己录制的数据集上效果很差，而相同的外参在 vins-fusion 上的效果却还不错。可能的原因是，公开数据集的 imu 与 图像帧有硬件同步且参考同一个时间基准，而自己录制的数据集未作同步且不是同一个时间基准，而 vins-fusion 在运行过程中在线校准 imu 和图像帧的时间偏移。这是二者存在的一个较为明显的区别，为了验证是否是未进行时间偏移估计导致的 AirSLAM 效果较差，笔者在 airslam 上增加了时间偏移估计，思路参考 vins-fusion。

对于多个传感器时间戳的质量，可以分成三类：
- 既同步，又有相同时间基准
- 不同步，但有相同时间基准
- 既不同步，又无相同时间基准

其中，无相同的时间基准对 VIO 或 SLAM 系统的影响最大

问题建模

首先我们需要搞清楚，是哪些数据组合喂给了前端：

- 接收到一帧新图像
- 根据这帧图像，以及上一帧图像的时间戳，收集在这段时间内的 imu 数据

如果存在时间基准的偏移，根据下图可以看到: 
- (1) 应当对应的 imu 数据
- (2) 实际喂给前端的 imu 数据

二者不再是同一个区间。

```
   |----x-----x----->
        |<--->|  (1)
|--ooooooooooooo->
     |<--->|     (2) 
|----x-----x----->
```

解决思路的核心是用现有的数据预测其他时间的数据。类似插值，然后使用插值得到的表达式对 时间差 做优化

最值得思索的是:

- 用已有的特征点去估计 imu batch 对应的起始或结束时刻的特征点位置

- 在应用的时候是以迭代的形式使用，使得算法能够处理较大时间偏移。




给同步的数据集人为增加时间偏移，作为真值。